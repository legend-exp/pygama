<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <title>hdf5_spec</title>
      <style>.markdown-preview:not([data-use-github-style]) { padding: 2em; font-size: 1.2em; color: rgb(85, 85, 85); background-color: white; overflow: auto; }
.markdown-preview:not([data-use-github-style]) > :first-child { margin-top: 0px; }
.markdown-preview:not([data-use-github-style]) h1, .markdown-preview:not([data-use-github-style]) h2, .markdown-preview:not([data-use-github-style]) h3, .markdown-preview:not([data-use-github-style]) h4, .markdown-preview:not([data-use-github-style]) h5, .markdown-preview:not([data-use-github-style]) h6 { line-height: 1.2; margin-top: 1.5em; margin-bottom: 0.5em; color: rgb(3, 3, 3); }
.markdown-preview:not([data-use-github-style]) h1 { font-size: 2.4em; font-weight: 300; }
.markdown-preview:not([data-use-github-style]) h2 { font-size: 1.8em; font-weight: 400; }
.markdown-preview:not([data-use-github-style]) h3 { font-size: 1.5em; font-weight: 500; }
.markdown-preview:not([data-use-github-style]) h4 { font-size: 1.2em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) h5 { font-size: 1.1em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) h6 { font-size: 1em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) strong { color: rgb(3, 3, 3); }
.markdown-preview:not([data-use-github-style]) del { color: rgb(126, 126, 126); }
.markdown-preview:not([data-use-github-style]) a, .markdown-preview:not([data-use-github-style]) a code { color: black; }
.markdown-preview:not([data-use-github-style]) img { max-width: 100%; }
.markdown-preview:not([data-use-github-style]) > p { margin-top: 0px; margin-bottom: 1.5em; }
.markdown-preview:not([data-use-github-style]) > ul, .markdown-preview:not([data-use-github-style]) > ol { margin-bottom: 1.5em; }
.markdown-preview:not([data-use-github-style]) blockquote { margin: 1.5em 0px; font-size: inherit; color: rgb(126, 126, 126); border-color: rgb(214, 214, 214); border-width: 4px; }
.markdown-preview:not([data-use-github-style]) hr { margin: 3em 0px; border-top: 2px dashed rgb(214, 214, 214); background: none; }
.markdown-preview:not([data-use-github-style]) table { margin: 1.5em 0px; }
.markdown-preview:not([data-use-github-style]) th { color: rgb(3, 3, 3); }
.markdown-preview:not([data-use-github-style]) th, .markdown-preview:not([data-use-github-style]) td { padding: 0.66em 1em; border: 1px solid rgb(214, 214, 214); }
.markdown-preview:not([data-use-github-style]) code { color: rgb(3, 3, 3); background-color: rgb(240, 240, 240); }
.markdown-preview:not([data-use-github-style]) pre.editor-colors { margin: 1.5em 0px; padding: 1em; font-size: 0.92em; border-radius: 3px; background-color: rgb(245, 245, 245); }
.markdown-preview:not([data-use-github-style]) kbd { color: rgb(3, 3, 3); border-width: 1px 1px 2px; border-style: solid; border-color: rgb(214, 214, 214) rgb(214, 214, 214) rgb(199, 199, 199); border-image: initial; background-color: rgb(240, 240, 240); }
.markdown-preview[data-use-github-style] { font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif; line-height: 1.6; word-wrap: break-word; padding: 30px; font-size: 16px; color: rgb(51, 51, 51); background-color: rgb(255, 255, 255); overflow: scroll; }
.markdown-preview[data-use-github-style] > :first-child { margin-top: 0px !important; }
.markdown-preview[data-use-github-style] > :last-child { margin-bottom: 0px !important; }
.markdown-preview[data-use-github-style] a:not([href]) { color: inherit; text-decoration: none; }
.markdown-preview[data-use-github-style] .absent { color: rgb(204, 0, 0); }
.markdown-preview[data-use-github-style] .anchor { position: absolute; top: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; }
.markdown-preview[data-use-github-style] .anchor:focus { outline: none; }
.markdown-preview[data-use-github-style] h1, .markdown-preview[data-use-github-style] h2, .markdown-preview[data-use-github-style] h3, .markdown-preview[data-use-github-style] h4, .markdown-preview[data-use-github-style] h5, .markdown-preview[data-use-github-style] h6 { position: relative; margin-top: 1em; margin-bottom: 16px; font-weight: bold; line-height: 1.4; }
.markdown-preview[data-use-github-style] h1 .octicon-link, .markdown-preview[data-use-github-style] h2 .octicon-link, .markdown-preview[data-use-github-style] h3 .octicon-link, .markdown-preview[data-use-github-style] h4 .octicon-link, .markdown-preview[data-use-github-style] h5 .octicon-link, .markdown-preview[data-use-github-style] h6 .octicon-link { display: none; color: rgb(0, 0, 0); vertical-align: middle; }
.markdown-preview[data-use-github-style] h1:hover .anchor, .markdown-preview[data-use-github-style] h2:hover .anchor, .markdown-preview[data-use-github-style] h3:hover .anchor, .markdown-preview[data-use-github-style] h4:hover .anchor, .markdown-preview[data-use-github-style] h5:hover .anchor, .markdown-preview[data-use-github-style] h6:hover .anchor { padding-left: 8px; margin-left: -30px; text-decoration: none; }
.markdown-preview[data-use-github-style] h1:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h2:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h3:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h4:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h5:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h6:hover .anchor .octicon-link { display: inline-block; }
.markdown-preview[data-use-github-style] h1 tt, .markdown-preview[data-use-github-style] h2 tt, .markdown-preview[data-use-github-style] h3 tt, .markdown-preview[data-use-github-style] h4 tt, .markdown-preview[data-use-github-style] h5 tt, .markdown-preview[data-use-github-style] h6 tt, .markdown-preview[data-use-github-style] h1 code, .markdown-preview[data-use-github-style] h2 code, .markdown-preview[data-use-github-style] h3 code, .markdown-preview[data-use-github-style] h4 code, .markdown-preview[data-use-github-style] h5 code, .markdown-preview[data-use-github-style] h6 code { font-size: inherit; }
.markdown-preview[data-use-github-style] h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
.markdown-preview[data-use-github-style] h1 .anchor { line-height: 1; }
.markdown-preview[data-use-github-style] h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
.markdown-preview[data-use-github-style] h2 .anchor { line-height: 1; }
.markdown-preview[data-use-github-style] h3 { font-size: 1.5em; line-height: 1.43; }
.markdown-preview[data-use-github-style] h3 .anchor { line-height: 1.2; }
.markdown-preview[data-use-github-style] h4 { font-size: 1.25em; }
.markdown-preview[data-use-github-style] h4 .anchor { line-height: 1.2; }
.markdown-preview[data-use-github-style] h5 { font-size: 1em; }
.markdown-preview[data-use-github-style] h5 .anchor { line-height: 1.1; }
.markdown-preview[data-use-github-style] h6 { font-size: 1em; color: rgb(119, 119, 119); }
.markdown-preview[data-use-github-style] h6 .anchor { line-height: 1.1; }
.markdown-preview[data-use-github-style] p, .markdown-preview[data-use-github-style] blockquote, .markdown-preview[data-use-github-style] ul, .markdown-preview[data-use-github-style] ol, .markdown-preview[data-use-github-style] dl, .markdown-preview[data-use-github-style] table, .markdown-preview[data-use-github-style] pre { margin-top: 0px; margin-bottom: 16px; }
.markdown-preview[data-use-github-style] hr { height: 4px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border: 0px none; }
.markdown-preview[data-use-github-style] ul, .markdown-preview[data-use-github-style] ol { padding-left: 2em; }
.markdown-preview[data-use-github-style] ul.no-list, .markdown-preview[data-use-github-style] ol.no-list { padding: 0px; list-style-type: none; }
.markdown-preview[data-use-github-style] ul ul, .markdown-preview[data-use-github-style] ul ol, .markdown-preview[data-use-github-style] ol ol, .markdown-preview[data-use-github-style] ol ul { margin-top: 0px; margin-bottom: 0px; }
.markdown-preview[data-use-github-style] li > p { margin-top: 16px; }
.markdown-preview[data-use-github-style] dl { padding: 0px; }
.markdown-preview[data-use-github-style] dl dt { padding: 0px; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: bold; }
.markdown-preview[data-use-github-style] dl dd { padding: 0px 16px; margin-bottom: 16px; }
.markdown-preview[data-use-github-style] blockquote { padding: 0px 15px; color: rgb(119, 119, 119); border-left: 4px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] blockquote > :first-child { margin-top: 0px; }
.markdown-preview[data-use-github-style] blockquote > :last-child { margin-bottom: 0px; }
.markdown-preview[data-use-github-style] table { display: block; width: 100%; overflow: auto; word-break: keep-all; }
.markdown-preview[data-use-github-style] table th { font-weight: bold; }
.markdown-preview[data-use-github-style] table th, .markdown-preview[data-use-github-style] table td { padding: 6px 13px; border: 1px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] table tr { background-color: rgb(255, 255, 255); border-top: 1px solid rgb(204, 204, 204); }
.markdown-preview[data-use-github-style] table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
.markdown-preview[data-use-github-style] img { max-width: 100%; box-sizing: border-box; }
.markdown-preview[data-use-github-style] .emoji { max-width: none; }
.markdown-preview[data-use-github-style] span.frame { display: block; overflow: hidden; }
.markdown-preview[data-use-github-style] span.frame > span { display: block; float: left; width: auto; padding: 7px; margin: 13px 0px 0px; overflow: hidden; border: 1px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] span.frame span img { display: block; float: left; }
.markdown-preview[data-use-github-style] span.frame span span { display: block; padding: 5px 0px 0px; clear: both; color: rgb(51, 51, 51); }
.markdown-preview[data-use-github-style] span.align-center { display: block; overflow: hidden; clear: both; }
.markdown-preview[data-use-github-style] span.align-center > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: center; }
.markdown-preview[data-use-github-style] span.align-center span img { margin: 0px auto; text-align: center; }
.markdown-preview[data-use-github-style] span.align-right { display: block; overflow: hidden; clear: both; }
.markdown-preview[data-use-github-style] span.align-right > span { display: block; margin: 13px 0px 0px; overflow: hidden; text-align: right; }
.markdown-preview[data-use-github-style] span.align-right span img { margin: 0px; text-align: right; }
.markdown-preview[data-use-github-style] span.float-left { display: block; float: left; margin-right: 13px; overflow: hidden; }
.markdown-preview[data-use-github-style] span.float-left span { margin: 13px 0px 0px; }
.markdown-preview[data-use-github-style] span.float-right { display: block; float: right; margin-left: 13px; overflow: hidden; }
.markdown-preview[data-use-github-style] span.float-right > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: right; }
.markdown-preview[data-use-github-style] code, .markdown-preview[data-use-github-style] tt { padding: 0.2em 0px; margin: 0px; font-size: 85%; background-color: rgba(0, 0, 0, 0.04); border-radius: 3px; }
.markdown-preview[data-use-github-style] code::before, .markdown-preview[data-use-github-style] tt::before, .markdown-preview[data-use-github-style] code::after, .markdown-preview[data-use-github-style] tt::after { letter-spacing: -0.2em; content: "Â "; }
.markdown-preview[data-use-github-style] code br, .markdown-preview[data-use-github-style] tt br { display: none; }
.markdown-preview[data-use-github-style] del code { text-decoration: inherit; }
.markdown-preview[data-use-github-style] pre > code { padding: 0px; margin: 0px; font-size: 100%; word-break: normal; white-space: pre; background: transparent; border: 0px; }
.markdown-preview[data-use-github-style] .highlight { margin-bottom: 16px; }
.markdown-preview[data-use-github-style] .highlight pre, .markdown-preview[data-use-github-style] pre { padding: 16px; overflow: auto; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border-radius: 3px; }
.markdown-preview[data-use-github-style] .highlight pre { margin-bottom: 0px; word-break: normal; }
.markdown-preview[data-use-github-style] pre { word-wrap: normal; }
.markdown-preview[data-use-github-style] pre code, .markdown-preview[data-use-github-style] pre tt { display: inline; max-width: initial; padding: 0px; margin: 0px; overflow: initial; line-height: inherit; word-wrap: normal; background-color: transparent; border: 0px; }
.markdown-preview[data-use-github-style] pre code::before, .markdown-preview[data-use-github-style] pre tt::before, .markdown-preview[data-use-github-style] pre code::after, .markdown-preview[data-use-github-style] pre tt::after { content: normal; }
.markdown-preview[data-use-github-style] kbd { display: inline-block; padding: 3px 5px; font-size: 11px; line-height: 10px; color: rgb(85, 85, 85); vertical-align: middle; background-color: rgb(252, 252, 252); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(187, 187, 187); border-image: initial; border-radius: 3px; box-shadow: rgb(187, 187, 187) 0px -1px 0px inset; }
.markdown-preview[data-use-github-style] a { color: rgb(51, 122, 183); }
.markdown-preview[data-use-github-style] code { color: inherit; }
.markdown-preview[data-use-github-style] pre.editor-colors { padding: 0.8em 1em; margin-bottom: 1em; font-size: 0.85em; border-radius: 4px; overflow: auto; }
.markdown-preview pre.editor-colors { user-select: auto; }
.scrollbars-visible-always .markdown-preview pre.editor-colors .vertical-scrollbar, .scrollbars-visible-always .markdown-preview pre.editor-colors .horizontal-scrollbar { visibility: hidden; }
.scrollbars-visible-always .markdown-preview pre.editor-colors:hover .vertical-scrollbar, .scrollbars-visible-always .markdown-preview pre.editor-colors:hover .horizontal-scrollbar { visibility: visible; }
.markdown-preview .task-list-item-checkbox { position: absolute; margin: 0.25em 0px 0px -1.4em; }
.markdown-preview ul label { vertical-align: top; }
.bracket-matcher .region {
  border-bottom: 1px dotted lime;
  position: absolute;
}
.line-number.bracket-matcher.bracket-matcher {
  color: #555;
  background-color: rgba(255, 255, 134, 0.34);
}

pre.editor-colors {
  background-color: white;
  color: #555;
}
pre.editor-colors .invisible-character {
  color: rgba(85, 85, 85, 0.2);
}
pre.editor-colors .indent-guide {
  color: rgba(85, 85, 85, 0.2);
}
pre.editor-colors .wrap-guide {
  background-color: rgba(85, 85, 85, 0.2);
}
pre.editor-colors .gutter {
  color: #555;
  background: white;
}
pre.editor-colors .gutter .line-number.folded,
pre.editor-colors .gutter .line-number:after,
pre.editor-colors .fold-marker:after {
  color: #e87b00;
}
pre.editor-colors .invisible {
  color: #555;
}
pre.editor-colors .selection .region {
  background-color: #e1e1e1;
}
pre.editor-colors .bracket-matcher .region {
  background-color: #C9C9C9;
  opacity: .7;
  border-bottom: 0 none;
}
pre.editor-colors.is-focused .cursor {
  border-color: black;
}
pre.editor-colors.is-focused .selection .region {
  background-color: #afc4da;
}
pre.editor-colors.is-focused .line-number.cursor-line-no-selection,
pre.editor-colors.is-focused .line.cursor-line {
  background-color: rgba(255, 255, 134, 0.34);
}
.syntax--comment {
  color: #999988;
  font-style: italic;
}
.syntax--string {
  color: #D14;
}
.syntax--string .syntax--source,
.syntax--string .syntax--meta.syntax--embedded.syntax--line {
  color: #5A5A5A;
}
.syntax--string .syntax--punctuation.syntax--section.syntax--embedded {
  color: #920B2D;
}
.syntax--string .syntax--punctuation.syntax--section.syntax--embedded .syntax--source {
  color: #920B2D;
}
.syntax--constant.syntax--numeric {
  color: #D14;
}
.syntax--constant.syntax--language {
  color: #606aa1;
}
.syntax--constant.syntax--character,
.syntax--constant.syntax--other {
  color: #606aa1;
}
.syntax--constant.syntax--symbol {
  color: #990073;
}
.syntax--constant.syntax--numeric.syntax--line-number.syntax--find-in-files .syntax--match {
  color: rgba(143, 190, 0, 0.63);
}
.syntax--variable {
  color: #008080;
}
.syntax--variable.syntax--parameter {
  color: #606aa1;
}
.syntax--keyword {
  color: #222;
  font-weight: bold;
}
.syntax--keyword.syntax--unit {
  color: #445588;
}
.syntax--keyword.syntax--special-method {
  color: #0086B3;
}
.syntax--storage {
  color: #222;
}
.syntax--storage.syntax--type {
  color: #222;
}
.syntax--entity.syntax--name.syntax--class {
  text-decoration: underline;
  color: #606aa1;
}
.syntax--entity.syntax--other.syntax--inherited-class {
  text-decoration: underline;
  color: #606aa1;
}
.syntax--entity.syntax--name.syntax--function {
  color: #900;
}
.syntax--entity.syntax--name.syntax--tag {
  color: #008080;
}
.syntax--entity.syntax--other.syntax--attribute-name {
  color: #458;
  font-weight: bold;
}
.syntax--entity.syntax--name.syntax--filename.syntax--find-in-files {
  color: #E6DB74;
}
.syntax--support.syntax--constant,
.syntax--support.syntax--function,
.syntax--support.syntax--type {
  color: #458;
}
.syntax--support.syntax--class {
  color: #008080;
}
.syntax--invalid {
  color: #F8F8F0;
  background-color: #00A8C6;
}
.syntax--invalid.syntax--deprecated {
  color: #F8F8F0;
  background-color: #8FBE00;
}
.syntax--meta.syntax--structure.syntax--dictionary.syntax--json > .syntax--string.syntax--quoted.syntax--double.syntax--json,
.syntax--meta.syntax--structure.syntax--dictionary.syntax--json > .syntax--string.syntax--quoted.syntax--double.syntax--json .syntax--punctuation.syntax--string {
  color: #000080;
}
.syntax--meta.syntax--structure.syntax--dictionary.syntax--value.syntax--json > .syntax--string.syntax--quoted.syntax--double.syntax--json {
  color: #d14;
}
.syntax--meta.syntax--diff,
.syntax--meta.syntax--diff.syntax--header {
  color: #75715E;
}
.syntax--css.syntax--support.syntax--property-name {
  font-weight: bold;
  color: #333;
}
.syntax--css.syntax--constant {
  color: #099;
}
.syntax--source.syntax--gfm {
  color: #444;
}
.syntax--gfm .syntax--markup.syntax--heading {
  color: #111;
}
.syntax--gfm .syntax--link {
  color: #888;
}
.syntax--gfm .syntax--variable.syntax--list {
  color: #888;
}
.syntax--markdown .syntax--paragraph {
  color: #444;
}
.syntax--markdown .syntax--heading {
  color: #111;
}
.syntax--markdown .syntax--link {
  color: #888;
}
.syntax--markdown .syntax--link .syntax--string {
  color: #888;
}
</style>
  </head>
  <body class='markdown-preview' data-use-github-style><h1 id="legend-data-format-specs-draft-">LEGEND Data Format Specs [DRAFT]</h1>
<h2 id="general-considerations">General considerations</h2>
<p>In the interest of long-term data accessibility and to ensure compliance with FAIR data principles,</p>
<ul>
<li><p>The number of different file formats should be kept to a reasonable minimum.</p>
</li>
<li><p>Only mature, well documented and and widely supported data formats with mature implementations/bindings for multiple programming languages are used.</p>
</li>
<li><p>Custom file formats are, if at all, only used for raw data produced by DAQ systems. As raw data tends to be archived long-term, any custom raw data formats must fulfil the following requirements:</p>
<ul>
<li><p>A complete formal description of the format exists and is made publicly available under a license that allows for independent third-party implementations.</p>
</li>
<li><p>At least verified implementations is made publicly available under an open-source license.</p>
</li>
</ul>
</li>
</ul>
<h2 id="choice-of-file-formats-preliminary-">Choice of file formats (preliminary)</h2>
<p>Depending on the kind of data, the following formats are preferred:</p>
<ul>
<li><p>Binary data: HDF5</p>
</li>
<li><p>Metadata: JSON</p>
</li>
</ul>
<h2 id="abstract-data-model">Abstract data model</h2>
<p>LEGEND data should, whereever possible, be representable by a simple data model consisting of:</p>
<ul>
<li><p>Scalar values</p>
</li>
<li><p>Vectors or higher-dimensional arrays. Arrays may be flat and contain scalar numerical values or nested and contain arrays, but must not contain structs or tables.</p>
</li>
<li><p>Structs (resp. "Dicts" or named tuples) of named fields. Fields may contain scalar values, arrays or structs. In-memory representations of structs may be objects, named t</p>
</li>
<li><p>Tables (a.k.a. "DataFrames"), represented by structs of column-vectors of equal length.</p>
</li>
</ul>
<p>Numerical values may be accompanied by physical units.</p>
<p>A generic mapping of this data model must be defined for each file format used. The mapping must be self-documenting.</p>
<h1 id="low-level-daq-data-structure">Low-level DAQ Data Structure</h1>
<h2 id="general-daq-structure">General DAQ structure</h2>
<p>DAQ data is represented by a table, each row represents a DAQ event on a single (physical or logical) input channel. Event building will happen at a higher data level.</p>
<p>The detailed structure of DAQ data will depend on the DAQ system and experimental setup. However, fields like these may become mandatory for all DAQs:</p>
<ul>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">ch</code>: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">array&lt;1&gt;{real}</code></li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">evttype</code>: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">array&lt;1&gt;{enum{evt_undef=0,evt_real=1,evt_pulser=2,evt_mc=3,evt_baseline=4}}</code></li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">daqevtno</code>: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">array&lt;1&gt;{real}</code></li>
</ul>
<p>A DAQ system with waveform digitization will provide columns like</p>
<ul>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">waveform_lf</code>: array&lt;1&gt;{waveform}, see below</li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">waveform_hf</code>: array&lt;1&gt;{waveform}, see below</li>
</ul>
<p>If the DAQ performs an internal pulse-shape analysis (digital or analog), energy reconstruction and other columns may be available, e.g.:</p>
<ul>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">psa_energy</code>: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">array&lt;1&gt;{real}</code></li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">psa_trise</code>: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">array&lt;1&gt;{real}</code></li>
</ul>
<p>Other DAQ and setup-specific columns will often be present, e.g.</p>
<ul>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">muveto</code>: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">array&lt;1&gt;{real}</code></li>
</ul>
<p>The collaboration will decide on a list of recommended columns names, to ensure columns with same semantics will have the same name, independent of DAQ/setup.</p>
<p>Legacy data that does not separate low-level DAQ data and event building will also include a column</p>
<ul>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">evtno</code>: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">array&lt;1&gt;{real}</code></li>
</ul>
<h2 id="waveform-vectors">Waveform vectors</h2>
<p>Waveform data as be stored either directly in compressed form. Uncompressed waveform data is stored as a <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">table{t0,dt,values}</code>:</p>
<ul>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">t0</code>: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">array&lt;1&gt;{real}</code></li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">dt</code>: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">array&lt;1&gt;{real}</code></li>
<li>Either <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">values</code>: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">array&lt;1&gt;{array&lt;1&gt;{real}}</code> or <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">array_of_equalsized_arrays&lt;1,1&gt;{real}</code></li>
<li><p>or <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">encvalues</code>: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">table{bytes,... codec information ...}</code></p>
</li>
<li><p><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">encvalues</code>: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">table{bytes,... codec information ...}</code>
*</p>
</li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">bytes</code>: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">array&lt;1&gt;{array&lt;1&gt;{real}}</code></li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">some_codec_information</code>: ...</li>
</ul>
<p>Compressed waveform data is stored as a <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">table{t0,dt,encvalues}</code>:</p>
<ul>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">t0</code>: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">array&lt;1&gt;{real}</code></li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">dt</code>: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">array&lt;1&gt;{real}</code></li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">encvalues</code>: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">table{bytes,... codec information ...}</code></li>
</ul>
<p>The column <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">encvalues</code> has the structure</p>
<ul>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">bytes</code>: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">array&lt;1&gt;{array&lt;1&gt;{real}}</code></li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">some_codec_information</code>: ...</li>
</ul>
<h1 id="hdf5-file-format-incomplete-">HDF5 File Format [Incomplete]</h1>
<p>HDF5 is used as the primary binary data format in LEGEND.</p>
<p>The following describes a mapping between the abstract data model and HDF5. This specifies the structure of the HDF5 implicitly, but precisely, for any data that conforms to the data model. The mapping purposefully uses only common and basic HDF5 features, to ensure it can be easily and reliably implemented in multiple programming languages.</p>
<h2 id="hdf5-datasets-groups-and-attributes">HDF5 datasets, groups and attributes</h2>
<p>Different data types may be stored as an HDF5 dataset of the same type (e.g. a 2-dimensional dataset may represent a matrix or a vector of same-sized vectors). To make the HDF5 files self-documenting, the HDF5 attribute "datatype" is used to indicate the type semantics of datasets and groups.</p>
<h2 id="abstract-data-model-representation">Abstract data model representation</h2>
<p>The abstract data model is mapped as follows:</p>
<h2 id="scalar-values">Scalar values</h2>
<p>Single scalar values are stored as 0-dimensional datasets</p>
<p>Attribute "datatype": "real", "string", "symbol", ...</p>
<h2 id="arrays">Arrays</h2>
<h3 id="flat-arrays">Flat arrays</h3>
<p>Flat n-dimension arrays are stored as n-dimensional datasets</p>
<p>Attribute "datatype": "array&lt;2&gt;{ELEMENT_TYPE}"</p>
<h3 id="fixed-sized-arrays">Fixed-sized arrays</h3>
<p>...</p>
<p>Attribute "datatype": fixedsize_array&lt;1&gt;{ELEMENT_TYPE}"</p>
<h3 id="arrays-of-arrays-of-same-size">Arrays of arrays of same size</h3>
<p>Nested arrays of dimensionality n, m, ... are stored as flat n+m+n dimensional datasets.</p>
<p>... attribute to denote dimensionality split ...</p>
<p>Attribute "datatype": "array_of_equalsized_arrays&lt;N,M&gt;{ELEMENT_TYPE}"</p>
<h3 id="vectors-of-vectors-of-different-size">Vectors of vectors of different size</h3>
<p>Data of the inner arrays is flattened into a single 1-dimensional dataset. An auxiliary dataset stores the cumulative sum of the size of the inner arrays.</p>
<p>...</p>
<p>HDF Attributes:</p>
<ul>
<li>"datatype": "array&lt;1&gt;{array&lt;1&gt;{ELEMENT_TYPE}}"</li>
<li>"cumsum_length_ds": Name (as string) of the dataset that stores the cumulative sum of the size of the inner arrays.</li>
</ul>
<p>Note: Instead of referring to the auxiliary dataset by name, a HDF5 dataset reference may be used in the future (still to be evaluated).</p>
<h2 id="structs">Structs</h2>
<p>Structs are stored as HDF5 groups. Fields that are structs themselves are stored as sub-groups, scalars and arrays as datasets. Groups and datasets in the group are named after the fields of the struct.</p>
<p>HDF Attributes:</p>
<ul>
<li>"datatype": "struct{FIELDNAME_1,FIELDNAME_2,...}"</li>
</ul>
<h2 id="tables">Tables</h2>
<p>A Table are stored are group of datasets, each representing a column of the table.</p>
<p>HDF Attributes:</p>
<ul>
<li>"datatype": "table{COLNAME_1,COLNAME_2,...}"</li>
</ul>
<h2 id="enums">Enums</h2>
<p>Enum values are stores as integer values, but with the "datatype" attribute: "enum{NAME=INT_VALUE,...}". So a vector of enum values will have a "datatype" attribute like "array{enum{NAME=INT_VALUE,...}}""</p>
<h1 id="values-with-physical-units">Values with physical units</h1>
<p>For values with physical units, the dataset only contains the numerical values. The attribute "units" stores the unit information. The attribute value is the string representation of the common scientific notation for the unit. Unicode must not be used.</p>
<p>HDF Attributes:</p>
<ul>
<li>"units": e.g. "mm", "um", "keV"</li>
</ul>
<h1 id="data-compression">Data Compression</h1>
<p>In addition to compression features provided by standard data formats (HDF5, etc.), LEGEND data uses some custom data compression.</p>
<p>In the interest of long-term data accessibility and to ensure compliance with FAIR data principles, use of custom data compression methods has to be limited to a minimum number of methods and use cases. Long-term use is only acceptable if:</p>
<ul>
<li><p>The custom compression significantly outperforms standard compression methods in compression ratio and/or (de-)compression speed for important use cases.</p>
</li>
<li><p>A complete formal description of the algorithms exists and is made publicly available under a license that allows for independent third-party implementations.</p>
</li>
<li><p>Verified implementations exist in a least two different programming languages, at least one of which has been implemented independently from the formal description of the algorithm and at least one of which is made publicly available under an open-source license.</p>
</li>
</ul>
<h2 id="lossless-compression-of-integer-valued-waveform-vectors">Lossless compression of integer-valued waveform vectors</h2>
<p>As detector waveforms have specific shapes, custom compression algorithms optimized for this use case can show a much higher speed/throughput than generic compression algorithms, at similar compression ratios.</p>
<p>Currently, we use the following custom integer-waveform compression algorithms:</p>
<ul>
<li>radware-sigcompress v1.0</li>
</ul>
<p>Other compression algorithms are being developed, tested and evaluated.</p>
<p>Note: The algorithm(s) in use are still subject to change, long-term data compatibility is not guaranteed at this point.</p>
<h3 id="radware-sigcompress">radware-sigcompress</h3>
<p>There is no formal description of the radware-sigcompress algorithm yet, so the C-code of the original implementation ("sigcompress.c") will serve as the reference for now:</p>
<pre class="editor-colors lang-C"><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--block">// radware-sigcompress, v1.0</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--block">//</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--block">// This code is licensed under the MIT License (MIT).</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--comment syntax--block">// Copyright (c) 2018, David C. Radford &lt;radforddc@ornl.gov&gt;</span></span></div><div class="line"></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--support syntax--storage syntax--type">int</span> <span class="syntax--entity syntax--name syntax--function">compress_signal</span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span><span class="syntax--support syntax--storage syntax--type">short</span> <span class="syntax--keyword syntax--operator">*</span>sig_in<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> <span class="syntax--support syntax--storage syntax--type">unsigned</span> <span class="syntax--support syntax--storage syntax--type">short</span> <span class="syntax--keyword syntax--operator">*</span>sig_out<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> <span class="syntax--support syntax--storage syntax--type">int</span> sig_len_in<span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span></span></div><div class="line"></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--support syntax--storage syntax--type">int</span>   i<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> j<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> max1<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> max2<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> min1<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> min2<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> ds<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> nb1<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> nb2<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--support syntax--storage syntax--type">int</span>   iso<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> nw<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> bp<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> dd1<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> dd2<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--support syntax--storage syntax--type">unsigned</span> <span class="syntax--support syntax--storage syntax--type">short</span> db<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">2</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--support syntax--storage syntax--type">unsigned</span> <span class="syntax--support syntax--storage syntax--type">int</span>   <span class="syntax--keyword syntax--operator">*</span>dd <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span><span class="syntax--support syntax--storage syntax--type">unsigned</span> <span class="syntax--support syntax--storage syntax--type">int</span> <span class="syntax--keyword syntax--operator">*</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> db<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--storage syntax--modifier">static</span> <span class="syntax--support syntax--storage syntax--type">unsigned</span> <span class="syntax--support syntax--storage syntax--type">short</span> mask<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">17</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> <span class="syntax--constant syntax--numeric syntax--decimal">1</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">3</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">7</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">15</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> <span class="syntax--constant syntax--numeric syntax--decimal">31</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">63</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">127</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">255</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">                                    </span><span class="syntax--constant syntax--numeric syntax--decimal">511</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">1023</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">2047</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">4095</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> <span class="syntax--constant syntax--numeric syntax--decimal">8191</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">16383</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">32767</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">65535</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--comment syntax--block">//static int len[17] = {4096, 2048,512,256,128, 128,128,128,128,</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--comment syntax--block">//                      128,128,128,128, 48,48,48,48};</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--comment syntax--block">/* ------------ do compression of signal ------------ */</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span>j <span class="syntax--keyword syntax--operator">=</span> iso <span class="syntax--keyword syntax--operator">=</span> bp <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span>sig_out<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>iso<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> sig_len_in<span class="syntax--punctuation syntax--terminator syntax--statement">;</span>     <span class="syntax--comment syntax--block">// signal length</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--keyword syntax--control">while</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>j <span class="syntax--keyword syntax--operator">&lt;</span> sig_len_in<span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span>         <span class="syntax--comment syntax--block">// j = starting index of section of signal</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span><span class="syntax--comment syntax--block">// find optimal method and length for compression of next section of signal</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span>max1 <span class="syntax--keyword syntax--operator">=</span> min1 <span class="syntax--keyword syntax--operator">=</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>j<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span>max2 <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--keyword syntax--operator">-</span><span class="syntax--constant syntax--numeric syntax--decimal">16000</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span>min2 <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--constant syntax--numeric syntax--decimal">16000</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span>nb1 <span class="syntax--keyword syntax--operator">=</span> nb2 <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--constant syntax--numeric syntax--decimal">2</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span>nw <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--constant syntax--numeric syntax--decimal">1</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span><span class="syntax--keyword syntax--control">for</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>i<span class="syntax--keyword syntax--operator">=</span>j<span class="syntax--keyword syntax--operator">+</span><span class="syntax--constant syntax--numeric syntax--decimal">1</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i <span class="syntax--keyword syntax--operator">&lt;</span> sig_len_in <span class="syntax--keyword syntax--operator">&amp;&amp;</span> i <span class="syntax--keyword syntax--operator">&lt;</span> j<span class="syntax--keyword syntax--operator">+</span><span class="syntax--constant syntax--numeric syntax--decimal">48</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span> <span class="syntax--comment syntax--block">// FIXME; # 48 could be tuned better?</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>max1 <span class="syntax--keyword syntax--operator">&lt;</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> max1 <span class="syntax--keyword syntax--operator">=</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>min1 <span class="syntax--keyword syntax--operator">&gt;</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> min1 <span class="syntax--keyword syntax--operator">=</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span>ds <span class="syntax--keyword syntax--operator">=</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">-</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--keyword syntax--operator">-</span><span class="syntax--constant syntax--numeric syntax--decimal">1</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>max2 <span class="syntax--keyword syntax--operator">&lt;</span> ds<span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> max2 <span class="syntax--keyword syntax--operator">=</span> ds<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>min2 <span class="syntax--keyword syntax--operator">&gt;</span> ds<span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> min2 <span class="syntax--keyword syntax--operator">=</span> ds<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span>nw<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>max1<span class="syntax--keyword syntax--operator">-</span>min1 <span class="syntax--keyword syntax--operator">&lt;=</span> max2<span class="syntax--keyword syntax--operator">-</span>min2<span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span> <span class="syntax--comment syntax--block">// use absolute values</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span>nb2 <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--constant syntax--numeric syntax--decimal">99</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--keyword syntax--control">while</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>max1 <span class="syntax--keyword syntax--operator">-</span> min1 <span class="syntax--keyword syntax--operator">&gt;</span> mask<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>nb1<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> nb1<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--comment syntax--block">//for (; i &lt; sig_len_in &amp;&amp; i &lt; j+len[nb1]; i++) {</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--keyword syntax--control">for</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i <span class="syntax--keyword syntax--operator">&lt;</span> sig_len_in <span class="syntax--keyword syntax--operator">&amp;&amp;</span> i <span class="syntax--keyword syntax--operator">&lt;</span> j<span class="syntax--keyword syntax--operator">+</span><span class="syntax--constant syntax--numeric syntax--decimal">128</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span> <span class="syntax--comment syntax--block">// FIXME; # 128 could be tuned better?</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>max1 <span class="syntax--keyword syntax--operator">&lt;</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> max1 <span class="syntax--keyword syntax--operator">=</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span>dd1 <span class="syntax--keyword syntax--operator">=</span> max1 <span class="syntax--keyword syntax--operator">-</span> min1<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>min1 <span class="syntax--keyword syntax--operator">&gt;</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> dd1 <span class="syntax--keyword syntax--operator">=</span> max1 <span class="syntax--keyword syntax--operator">-</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>dd1 <span class="syntax--keyword syntax--operator">&gt;</span> mask<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>nb1<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--keyword syntax--control">break</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>min1 <span class="syntax--keyword syntax--operator">&gt;</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> min1 <span class="syntax--keyword syntax--operator">=</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span>nw<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span> <span class="syntax--keyword syntax--control">else</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span>                      <span class="syntax--comment syntax--block">// use difference values</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span>nb1 <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--constant syntax--numeric syntax--decimal">99</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--keyword syntax--control">while</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>max2 <span class="syntax--keyword syntax--operator">-</span> min2 <span class="syntax--keyword syntax--operator">&gt;</span> mask<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>nb2<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> nb2<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--comment syntax--block">//for (; i &lt; sig_len_in &amp;&amp; i &lt; j+len[nb1]; i++) {</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--keyword syntax--control">for</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i <span class="syntax--keyword syntax--operator">&lt;</span> sig_len_in <span class="syntax--keyword syntax--operator">&amp;&amp;</span> i <span class="syntax--keyword syntax--operator">&lt;</span> j<span class="syntax--keyword syntax--operator">+</span><span class="syntax--constant syntax--numeric syntax--decimal">128</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span> <span class="syntax--comment syntax--block">// FIXME; # 128 could be tuned better?</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span>ds <span class="syntax--keyword syntax--operator">=</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">-</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--keyword syntax--operator">-</span><span class="syntax--constant syntax--numeric syntax--decimal">1</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>max2 <span class="syntax--keyword syntax--operator">&lt;</span> ds<span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> max2 <span class="syntax--keyword syntax--operator">=</span> ds<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span>dd2 <span class="syntax--keyword syntax--operator">=</span> max2 <span class="syntax--keyword syntax--operator">-</span> min2<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>min2 <span class="syntax--keyword syntax--operator">&gt;</span> ds<span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> dd2 <span class="syntax--keyword syntax--operator">=</span> max2 <span class="syntax--keyword syntax--operator">-</span> ds<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>dd2 <span class="syntax--keyword syntax--operator">&gt;</span> mask<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>nb2<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--keyword syntax--control">break</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>min2 <span class="syntax--keyword syntax--operator">&gt;</span> ds<span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> min2 <span class="syntax--keyword syntax--operator">=</span> ds<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span>nw<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span></span></div><div class="line"></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>bp <span class="syntax--keyword syntax--operator">&gt;</span> <span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> iso<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span><span class="syntax--comment syntax--block">/*  -----  do actual compression  -----  */</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span>sig_out<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>iso<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> nw<span class="syntax--punctuation syntax--terminator syntax--statement">;</span>  <span class="syntax--comment syntax--block">// compressed signal data, first byte = # samples</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span>bp <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span>               <span class="syntax--comment syntax--block">// bit pointer</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>nb1 <span class="syntax--keyword syntax--operator">&lt;=</span> nb2<span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--comment syntax--block">/*  -----  encode absolute values  -----  */</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span>sig_out<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>iso<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> nb1<span class="syntax--punctuation syntax--terminator syntax--statement">;</span>                    <span class="syntax--comment syntax--block">// # bits used for encoding</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span>sig_out<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>iso<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span><span class="syntax--support syntax--storage syntax--type">unsigned</span> <span class="syntax--support syntax--storage syntax--type">short</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> min1<span class="syntax--punctuation syntax--terminator syntax--statement">;</span>  <span class="syntax--comment syntax--block">// min value used for encoding</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--keyword syntax--control">for</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>i <span class="syntax--keyword syntax--operator">=</span> iso<span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i <span class="syntax--keyword syntax--operator">&lt;=</span> iso <span class="syntax--keyword syntax--operator">+</span> nw<span class="syntax--keyword syntax--operator">*</span>nb1<span class="syntax--keyword syntax--operator">/</span><span class="syntax--constant syntax--numeric syntax--decimal">16</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> sig_out<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--keyword syntax--control">for</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>i <span class="syntax--keyword syntax--operator">=</span> j<span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i <span class="syntax--keyword syntax--operator">&lt;</span> j <span class="syntax--keyword syntax--operator">+</span> nw<span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span>dd<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">-</span> min1<span class="syntax--punctuation syntax--terminator syntax--statement">;</span>              <span class="syntax--comment syntax--block">// value to encode</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span>dd<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> dd<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">&lt;&lt;</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span><span class="syntax--constant syntax--numeric syntax--decimal">32</span> <span class="syntax--keyword syntax--operator">-</span> bp <span class="syntax--keyword syntax--operator">-</span> nb1<span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span>sig_out<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>iso<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">|=</span> db<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">1</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span>bp <span class="syntax--keyword syntax--operator">+=</span> nb1<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>bp <span class="syntax--keyword syntax--operator">&gt;</span> <span class="syntax--constant syntax--numeric syntax--decimal">15</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">          </span>sig_out<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--keyword syntax--operator">++</span>iso<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> db<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">          </span>bp <span class="syntax--keyword syntax--operator">-=</span> <span class="syntax--constant syntax--numeric syntax--decimal">16</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span></span></div><div class="line"></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span> <span class="syntax--keyword syntax--control">else</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--comment syntax--block">/*  -----  encode derivative / difference values  -----  */</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span>sig_out<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>iso<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> nb2 <span class="syntax--keyword syntax--operator">+</span> <span class="syntax--constant syntax--numeric syntax--decimal">32</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span>  <span class="syntax--comment syntax--block">// # bits used for encoding, plus flag</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span>sig_out<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>iso<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span><span class="syntax--support syntax--storage syntax--type">unsigned</span> <span class="syntax--support syntax--storage syntax--type">short</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>j<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span>  <span class="syntax--comment syntax--block">// starting signal value</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span>sig_out<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>iso<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span><span class="syntax--support syntax--storage syntax--type">unsigned</span> <span class="syntax--support syntax--storage syntax--type">short</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> min2<span class="syntax--punctuation syntax--terminator syntax--statement">;</span>       <span class="syntax--comment syntax--block">// min value used for encoding</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--keyword syntax--control">for</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>i <span class="syntax--keyword syntax--operator">=</span> iso<span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i <span class="syntax--keyword syntax--operator">&lt;=</span> iso <span class="syntax--keyword syntax--operator">+</span> nw<span class="syntax--keyword syntax--operator">*</span>nb2<span class="syntax--keyword syntax--operator">/</span><span class="syntax--constant syntax--numeric syntax--decimal">16</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> sig_out<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--keyword syntax--control">for</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>i <span class="syntax--keyword syntax--operator">=</span> j<span class="syntax--keyword syntax--operator">+</span><span class="syntax--constant syntax--numeric syntax--decimal">1</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i <span class="syntax--keyword syntax--operator">&lt;</span> j <span class="syntax--keyword syntax--operator">+</span> nw<span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span>dd<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">-</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--keyword syntax--operator">-</span><span class="syntax--constant syntax--numeric syntax--decimal">1</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">-</span> min2<span class="syntax--punctuation syntax--terminator syntax--statement">;</span>     <span class="syntax--comment syntax--block">// value to encode</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span>dd<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--keyword syntax--operator">=</span> dd<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">&lt;&lt;</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span><span class="syntax--constant syntax--numeric syntax--decimal">32</span> <span class="syntax--keyword syntax--operator">-</span> bp <span class="syntax--keyword syntax--operator">-</span> nb2<span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span>sig_out<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>iso<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">|=</span> db<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">1</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span>bp <span class="syntax--keyword syntax--operator">+=</span> nb2<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>bp <span class="syntax--keyword syntax--operator">&gt;</span> <span class="syntax--constant syntax--numeric syntax--decimal">15</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">          </span>sig_out<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--keyword syntax--operator">++</span>iso<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> db<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">          </span>bp <span class="syntax--keyword syntax--operator">-=</span> <span class="syntax--constant syntax--numeric syntax--decimal">16</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span>j <span class="syntax--keyword syntax--operator">+=</span> nw<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span></span></div><div class="line"></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>bp <span class="syntax--keyword syntax--operator">&gt;</span> <span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> iso<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>iso<span class="syntax--keyword syntax--operator">%</span><span class="syntax--constant syntax--numeric syntax--decimal">2</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> iso<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span>     <span class="syntax--comment syntax--block">// make sure iso is even for 4-byte padding</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--keyword syntax--control">return</span> iso<span class="syntax--punctuation syntax--terminator syntax--statement">;</span>           <span class="syntax--comment syntax--block">// number of shorts in compressed signal data</span></span></div><div class="line"></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span> <span class="syntax--comment syntax--block">/* compress_signal */</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--support syntax--storage syntax--type">int</span> <span class="syntax--entity syntax--name syntax--function">decompress_signal</span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span><span class="syntax--support syntax--storage syntax--type">unsigned</span> <span class="syntax--support syntax--storage syntax--type">short</span> <span class="syntax--keyword syntax--operator">*</span>sig_in<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> <span class="syntax--support syntax--storage syntax--type">short</span> <span class="syntax--keyword syntax--operator">*</span>sig_out<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> <span class="syntax--support syntax--storage syntax--type">int</span> sig_len_in<span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span></span></div><div class="line"></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--support syntax--storage syntax--type">int</span>   i<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> j<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> min<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> nb<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> isi<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> iso<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> nw<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> bp<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> siglen<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--support syntax--storage syntax--type">unsigned</span> <span class="syntax--support syntax--storage syntax--type">short</span> db<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">2</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--support syntax--storage syntax--type">unsigned</span> <span class="syntax--support syntax--storage syntax--type">int</span>   <span class="syntax--keyword syntax--operator">*</span>dd <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span><span class="syntax--support syntax--storage syntax--type">unsigned</span> <span class="syntax--support syntax--storage syntax--type">int</span> <span class="syntax--keyword syntax--operator">*</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> db<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--storage syntax--modifier">static</span> <span class="syntax--support syntax--storage syntax--type">unsigned</span> <span class="syntax--support syntax--storage syntax--type">short</span> mask<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">17</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> <span class="syntax--constant syntax--numeric syntax--decimal">1</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">3</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">7</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">15</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> <span class="syntax--constant syntax--numeric syntax--decimal">31</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">63</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">127</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">255</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">                                    </span><span class="syntax--constant syntax--numeric syntax--decimal">511</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">1023</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">2047</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">4095</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> <span class="syntax--constant syntax--numeric syntax--decimal">8191</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">16383</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">32767</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span><span class="syntax--constant syntax--numeric syntax--decimal">65535</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--comment syntax--block">/* ------------ do decompression of signal ------------ */</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span>j <span class="syntax--keyword syntax--operator">=</span> isi <span class="syntax--keyword syntax--operator">=</span> iso <span class="syntax--keyword syntax--operator">=</span> bp <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span>siglen <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span><span class="syntax--support syntax--storage syntax--type">short</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>isi<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span>  <span class="syntax--comment syntax--block">// signal length</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--comment syntax--block">//printf("&lt;&lt;&lt; siglen = %d\n", siglen);</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--keyword syntax--control">for</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>i<span class="syntax--keyword syntax--operator">=</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i<span class="syntax--keyword syntax--operator">&lt;</span><span class="syntax--constant syntax--numeric syntax--decimal">2048</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> sig_out<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>i<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--keyword syntax--control">while</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>isi <span class="syntax--keyword syntax--operator">&lt;</span> sig_len_in <span class="syntax--keyword syntax--operator">&amp;&amp;</span> iso <span class="syntax--keyword syntax--operator">&lt;</span> siglen<span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>bp <span class="syntax--keyword syntax--operator">&gt;</span> <span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> isi<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span>bp <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span>              <span class="syntax--comment syntax--block">// bit pointer</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span>nw <span class="syntax--keyword syntax--operator">=</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>isi<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span>  <span class="syntax--comment syntax--block">// number of samples encoded in this chunk</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span>nb <span class="syntax--keyword syntax--operator">=</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>isi<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span>  <span class="syntax--comment syntax--block">// number of bits used in compression</span></span></div><div class="line"></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>nb <span class="syntax--keyword syntax--operator">&lt;</span> <span class="syntax--constant syntax--numeric syntax--decimal">32</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--comment syntax--block">/*  -----  decode absolute values  -----  */</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span>min <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span><span class="syntax--support syntax--storage syntax--type">short</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>isi<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span>  <span class="syntax--comment syntax--block">// min value used for encoding</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span>db<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>isi<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--keyword syntax--control">for</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>i <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i <span class="syntax--keyword syntax--operator">&lt;</span> nw <span class="syntax--keyword syntax--operator">&amp;&amp;</span> iso <span class="syntax--keyword syntax--operator">&lt;</span> siglen<span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>bp<span class="syntax--keyword syntax--operator">+</span>nb <span class="syntax--keyword syntax--operator">&gt;</span> <span class="syntax--constant syntax--numeric syntax--decimal">15</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">          </span>bp <span class="syntax--keyword syntax--operator">-=</span> <span class="syntax--constant syntax--numeric syntax--decimal">16</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">          </span>db<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">1</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>isi<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">          </span>db<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>isi<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">          </span>dd<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> dd<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">&lt;&lt;</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>bp<span class="syntax--keyword syntax--operator">+</span>nb<span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span> <span class="syntax--keyword syntax--control">else</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">          </span>dd<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> dd<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">&lt;&lt;</span> nb<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span>sig_out<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>iso<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>db<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">1</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">&amp;</span> mask<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>nb<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--keyword syntax--operator">+</span> min<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span>bp <span class="syntax--keyword syntax--operator">+=</span> nb<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span></span></div><div class="line"></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span> <span class="syntax--keyword syntax--control">else</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span>nb <span class="syntax--keyword syntax--operator">-=</span> <span class="syntax--constant syntax--numeric syntax--decimal">32</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--comment syntax--block">/*  -----  decode derivative / difference values  -----  */</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span>sig_out<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>iso<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span><span class="syntax--support syntax--storage syntax--type">short</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>isi<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span>  <span class="syntax--comment syntax--block">// starting signal value</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span>min <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span><span class="syntax--support syntax--storage syntax--type">short</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>isi<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span>             <span class="syntax--comment syntax--block">// min value used for encoding</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span>db<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>isi<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--keyword syntax--control">for</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>i <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--constant syntax--numeric syntax--decimal">1</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i <span class="syntax--keyword syntax--operator">&lt;</span> nw <span class="syntax--keyword syntax--operator">&amp;&amp;</span> iso <span class="syntax--keyword syntax--operator">&lt;</span> siglen<span class="syntax--punctuation syntax--terminator syntax--statement">;</span> i<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>bp<span class="syntax--keyword syntax--operator">+</span>nb <span class="syntax--keyword syntax--operator">&gt;</span> <span class="syntax--constant syntax--numeric syntax--decimal">15</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">          </span>bp <span class="syntax--keyword syntax--operator">-=</span> <span class="syntax--constant syntax--numeric syntax--decimal">16</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">          </span>db<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">1</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>isi<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">          </span>db<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> sig_in<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>isi<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">          </span>dd<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> dd<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">&lt;&lt;</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>bp<span class="syntax--keyword syntax--operator">+</span>nb<span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span> <span class="syntax--keyword syntax--control">else</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">          </span>dd<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> dd<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">0</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">&lt;&lt;</span> nb<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span>sig_out<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>iso<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">=</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>db<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span><span class="syntax--constant syntax--numeric syntax--decimal">1</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span> <span class="syntax--keyword syntax--operator">&amp;</span> mask<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>nb<span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--keyword syntax--operator">+</span> min <span class="syntax--keyword syntax--operator">+</span> sig_out<span class="syntax--punctuation syntax--definition syntax--begin syntax--bracket syntax--square">[</span>iso<span class="syntax--keyword syntax--operator">-</span><span class="syntax--constant syntax--numeric syntax--decimal">1</span><span class="syntax--punctuation syntax--definition syntax--end syntax--bracket syntax--square">]</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span> iso<span class="syntax--keyword syntax--operator">++</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">        </span>bp <span class="syntax--keyword syntax--operator">+=</span> nb<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">      </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span>j <span class="syntax--keyword syntax--operator">+=</span> nw<span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span></span></div><div class="line"></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--keyword syntax--control">if</span> <span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span>siglen <span class="syntax--keyword syntax--operator">!=</span> iso<span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span> <span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--bracket syntax--curly">{</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">    </span><span class="syntax--entity syntax--name syntax--function">printf</span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round">(</span><span class="syntax--string syntax--quoted syntax--double">"ERROR in decompress_signal: iso (%d ) != siglen (%d)!<span class="syntax--constant syntax--character syntax--escape">\n</span>"</span><span class="syntax--punctuation syntax--separator syntax--delimiter">,</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">           </span>iso<span class="syntax--punctuation syntax--separator syntax--delimiter">,</span> siglen<span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round">)</span><span class="syntax--punctuation syntax--terminator syntax--statement">;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="leading-whitespace">  </span><span class="syntax--keyword syntax--control">return</span> siglen<span class="syntax--punctuation syntax--terminator syntax--statement">;</span>       <span class="syntax--comment syntax--block">// number of shorts in decompressed signal data</span></span></div><div class="line"></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--bracket syntax--curly">}</span> <span class="syntax--comment syntax--block">/* decompress_signal */</span></span></div></pre></body>
</html>
